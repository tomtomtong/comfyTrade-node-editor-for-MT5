<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MT5 Node-Based Strategy Builder</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Top Toolbar -->
    <div class="toolbar">
      <div class="toolbar-left">
        <h1>MT5 Strategy Builder</h1>
        <div id="connectionStatus" class="status disconnected">Disconnected</div>
      </div>
      <div class="toolbar-right">
        <button id="connectBtn" class="btn btn-primary">Connect MT5</button>
        <button id="tradeBtn" class="btn btn-success">New Trade</button>
        <button id="showLogBtn" class="btn btn-secondary">Show Log</button>
        <button id="executeGraphBtn" class="btn btn-success">Execute Strategy</button>
        <button id="saveGraphBtn" class="btn btn-secondary">Save</button>
        <button id="loadGraphBtn" class="btn btn-secondary">Load</button>
        <button id="clearGraphBtn" class="btn btn-danger">Clear</button>
      </div>
    </div>

    <!-- Main Layout -->
    <div class="main-layout">
      <!-- Left Sidebar - Node Palette -->
      <div class="sidebar left-sidebar">
        <h3>Node Library</h3>
        
        <div class="node-category">
          <h4>Triggers</h4>
          <button class="node-btn trigger-btn" data-type="trigger-manual">⚡ Manual Trigger</button>
          <button class="node-btn trigger-btn" data-type="trigger-period">⏱️ Period Trigger</button>
        </div>

        <div class="node-category">
          <h4>Data Sources</h4>
          <button class="node-btn" data-type="market-data">Market Data</button>
          <button class="node-btn" data-type="constant">Constant Value</button>
        </div>

        <div class="node-category">
          <h4>Indicators</h4>
          <button class="node-btn" data-type="indicator-ma">Moving Average</button>
          <button class="node-btn" data-type="indicator-rsi">RSI</button>
        </div>

        <div class="node-category">
          <h4>Logic</h4>
          <button class="node-btn" data-type="compare">Compare</button>
          <button class="node-btn" data-type="logic-and">AND Gate</button>
          <button class="node-btn" data-type="logic-or">OR Gate</button>
        </div>

        <div class="node-category">
          <h4>Trading</h4>
          <button class="node-btn" data-type="trade-signal">Trade</button>
        </div>
      </div>

      <!-- Center - Node Editor Canvas -->
      <div class="editor-container">
        <canvas id="nodeCanvas"></canvas>
        <div class="canvas-hint">
          Click nodes from the left panel to add them to the canvas<br>
          Right-click or Ctrl+Click on connections to disconnect them<br>
          Colors indicate data types - connections must match compatible types
        </div>
      </div>

      <!-- Right Sidebar - Properties & Info -->
      <div class="sidebar right-sidebar">
        <div class="properties-panel">
          <h3>Properties</h3>
          <div id="nodeProperties">
            <p class="no-selection">Select a node to edit properties</p>
          </div>
        </div>

        <div class="account-panel">
          <h3>Account Info</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="label">Balance:</span>
              <span id="balance">-</span>
            </div>
            <div class="info-item">
              <span class="label">Equity:</span>
              <span id="equity">-</span>
            </div>
            <div class="info-item">
              <span class="label">Profit:</span>
              <span id="profit" class="profit">-</span>
            </div>
          </div>
          <button id="refreshAccountBtn" class="btn btn-secondary btn-small">Refresh</button>
        </div>

        <div class="positions-panel">
          <h3>Open Positions</h3>
          <div id="positionsList" class="positions-list">
            <p class="no-data">No open positions</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Connection Modal -->
    <div id="connectionModal" class="modal">
      <div class="modal-content">
        <h2>Connect to MT5</h2>
        <div class="connection-info">
          <p>Connecting to MetaTrader 5...</p>
          <p class="connection-details">Server: localhost:8765 (Python Bridge)</p>
        </div>
        <div class="modal-buttons">
          <button id="confirmConnectBtn" class="btn btn-primary">Connect</button>
          <button id="cancelConnectBtn" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Trade Modal -->
    <div id="tradeModal" class="modal">
      <div class="modal-content trade-modal">
        <h2>Execute Trade</h2>
        <div class="form-group">
          <label>Symbol:</label>
          <div id="symbolInputContainer"></div>
          <div class="quick-symbols">
            <button class="quick-symbol-btn" data-symbol="EURUSD">EURUSD</button>
            <button class="quick-symbol-btn" data-symbol="GBPUSD">GBPUSD</button>
            <button class="quick-symbol-btn" data-symbol="USDJPY">USDJPY</button>
            <button class="quick-symbol-btn" data-symbol="AUDUSD">AUDUSD</button>
            <button class="quick-symbol-btn" data-symbol="USDCAD">USDCAD</button>
          </div>
        </div>
        <div class="form-group">
          <label>Order Type:</label>
          <select id="tradeType">
            <option value="BUY">Buy</option>
            <option value="SELL">Sell</option>
          </select>
        </div>
        <div class="form-group">
          <label>Volume:</label>
          <input type="number" id="tradeVolume" step="0.01" min="0.01" value="0.1">
          <div id="volumeLossInfo" class="volume-loss-info" style="display: none;">
            <div class="loss-warning">
              <span class="warning-icon">⚠️</span>
              <span class="loss-text">Potential loss if price drops 1%: <span id="potentialLoss">$0.00</span></span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label>Stop Loss (optional):</label>
          <input type="number" id="tradeStopLoss" step="0.00001" placeholder="0 for none">
        </div>
        <div class="form-group">
          <label>Take Profit (optional):</label>
          <input type="number" id="tradeTakeProfit" step="0.00001" placeholder="0 for none">
        </div>
        <div class="modal-buttons">
          <button id="confirmTradeBtn" class="btn btn-primary">Execute Trade</button>
          <button id="cancelTradeBtn" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <div id="messageBox" class="message-box"></div>

    <!-- Log Modal -->
    <div id="logModal" class="modal">
      <div class="modal-content log-modal">
        <h2>Console Log</h2>
        <div class="log-controls">
          <button id="clearLogBtn" class="btn btn-secondary btn-small">Clear Log</button>
          <button id="copyLogBtn" class="btn btn-secondary btn-small">Copy Log</button>
        </div>
        <div id="logContent" class="log-content">
          <p class="no-log">No log entries yet. Try testing volume loss to see symbol info.</p>
        </div>
        <div class="modal-buttons">
          <button id="closeLogBtn" class="btn btn-primary">Close</button>
        </div>
      </div>
    </div>

    <!-- Volume Loss Reminder Modal -->
    <div id="priceDropAlert" class="price-drop-alert" style="display: none;">
      <h3>
        <span class="alert-icon">⚠️</span>
        Volume Loss Reminder
      </h3>
      <div class="alert-content">
        <p>If you execute this volume and price moves 1% against you:</p>
        <div class="alert-details">
          <div class="alert-detail-item">
            <span>Symbol:</span>
            <span id="alertSymbol">-</span>
          </div>
          <div class="alert-detail-item">
            <span>Volume:</span>
            <span id="alertVolume">-</span>
          </div>
          <div class="alert-detail-item">
            <span>Current Price:</span>
            <span id="alertEntryPrice">-</span>
          </div>
          <div class="alert-detail-item">
            <span>Price After 1% Drop:</span>
            <span id="alertCurrentPrice">-</span>
          </div>
          <div class="alert-detail-item">
            <span>Price Change:</span>
            <span id="alertPriceChange">-</span>
          </div>
          <div class="alert-detail-item">
            <span>Potential Loss:</span>
            <span id="alertCurrentLoss">-</span>
          </div>
        </div>
        
        <!-- MT5 Contract Information -->
        <div class="mt5-contract-info" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
          <h4 style="margin: 0 0 10px 0; color: #666; font-size: 14px;">MT5 Contract Details</h4>
          <div class="alert-details">
            <div class="alert-detail-item">
              <span>Tick Size:</span>
              <span id="alertTickSize">-</span>
            </div>
            <div class="alert-detail-item">
              <span>Pip Size:</span>
              <span id="alertPipSize">-</span>
            </div>
            <div class="alert-detail-item">
              <span>Tick Value:</span>
              <span id="alertTickValue">-</span>
            </div>
            <div class="alert-detail-item">
              <span>Pip Value:</span>
              <span id="alertPipValue">-</span>
            </div>
            <div class="alert-detail-item">
              <span>Contract Size:</span>
              <span id="alertContractSize">-</span>
            </div>
            <div class="alert-detail-item">
              <span>Ticks per Pip:</span>
              <span id="alertTicksPerPip">-</span>
            </div>
            <div class="alert-detail-item">
              <span>Price Change (Pips):</span>
              <span id="alertPriceChangePips">-</span>
            </div>
          </div>
        </div>
      </div>
      <div class="alert-actions">
        <button id="closeAlertBtn" class="btn btn-secondary">Close</button>
        <button id="modifyPositionBtn" class="btn btn-primary">Modify Position</button>
      </div>
    </div>
  </div>

  <script src="symbol-input.js"></script>
  <script src="node-editor.js"></script>
  <script src="renderer.js"></script>
</body>
</html>
